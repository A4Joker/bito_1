name: Create Bot Comment

on: 
  pull_request:
    types: [opened, synchronize]

permissions:
  pull-requests: write
  issues: write
  contents: read

jobs:
  bot-comment:
    runs-on: ubuntu-latest
    steps:
      - name: Create formatted bot comment with suggestion
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const body = `<div>
<div id="suggestion">
<div id="issue"><b>Exposed DB credentials</b></div>
<div id="fix">
Database credentials are hardcoded in plain text, making them vulnerable to exposure and unauthorized database access. This is a critical security flaw that could lead to data breaches. Store these in environment variables or a configuration file outside version control.
</div>
<details>
<summary>
<b>Code suggestion</b>
</summary>
<blockquote>Check the AI-generated fix before applying</blockquote>
<div id="code">

\`\`\`suggestion
# ðŸ”´ VIOLATION 1.2: Hardcoded Database Credentials
DB_HOST = os.environ.get('DB_HOST')
DB_USER = os.environ.get('DB_USER')
DB_PASSWORD = os.environ.get('DB_PASSWORD')
DB_NAME = os.environ.get('DB_NAME')
\`\`\`

</div>
</details>
</div>
<small><i>Code Review Run <a href="https://github.com/A4Joker/Bito_Test/pull/304#issuecomment-3581407382">#c29c28</a></i></small>
</div>`;
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: body
            })
